"""
项目总结：双智能体推荐系统的核心特性和创新点
"""

SYSTEM_OVERVIEW = \"\"\"
╔════════════════════════════════════════════════════════════════════════╗
║           🎯 项目总结：双智能体演化推荐系统                             ║
╚════════════════════════════════════════════════════════════════════════╝

【项目名称】
  双智能体推荐系统 (Dual-Agent Recommendation System with Evolution)

【核心目标】
  设计一个能够自我演化和相互促进的推荐系统，通过持续的用户交互形成
  精准的兴趣图谱，实现个性化推荐并逐步提升推荐质量。

【主要创新】
  1. 双智能体架构：推荐与评估的分离，形成闭环反馈
  2. 动态兴趣图谱：从用户交互中学习，持续演化用户模型  
  3. 演化机制：满足条件时触发两个智能体的版本升级
  4. 自我改进：智能体B从反馈中学习规则，指导智能体A改进
  5. LLM集成：利用Qwen2.5生成更自然的推荐理由
  6. 设备自适应：自动选择最优计算设备（GPU > MPS > CPU）
\"\"\"

KEY_FEATURES = \"\"\"
【核心特性详解】

1️⃣  智能体A - 推荐系统
   ─────────────────────
   功能：基于用户兴趣图谱和Qwen2.5模型生成个性化推荐
   
   工作流程：
   ├─ 获取用户兴趣图谱和排名前8的兴趣
   ├─ 构造包含查询和兴趣上下文的提示词
   ├─ 调用Qwen2.5生成5项推荐
   ├─ 对推荐进行排序（基于查询匹配度和兴趣匹配度）
   └─ 返回Top-5推荐
   
   改进方式：
   ├─ 接收来自智能体B的改进指导
   ├─ 调整排序策略
   ├─ 添加过滤规则
   └─ 版本号递增


2️⃣  智能体B - 评估和改进系统
   ────────────────────────
   功能：评估推荐质量，识别问题，生成改进建议，自我学习
   
   评估维度（4个）：
   ├─ 点击率 (40%) = 点击数 / 推荐数
   ├─ 浏览时长 (30%) = min(浏览秒数 / 300, 100%)
   ├─ 转化率 (20%) = 1 if 用户完成转化 else 0
   └─ 满意度 (10%) = 用户评分(0-1)
   
   问题识别：
   ├─ 点击率 < 0.3 → \"相关性不足\"
   ├─ 浏览时间 < 10s → \"吸引力不够\"
   ├─ 无转化 → \"未满足用户需求\"
   └─ 用户反馈 → 提取关键问题
   
   改进建议类型：
   ├─ improve_relevance (优化匹配)
   ├─ improve_description (优化描述)
   ├─ expand_diversity (增加多样性)
   └─ incorporate_feedback (纳入反馈)
   
   自我改进能力：
   ├─ 分析成功反馈模式（质量评分>0.7）
   ├─ 分析失败反馈模式（质量评分<0.4）
   ├─ 生成改进规则并保存
   └─ 建立规则库供后续使用


3️⃣  用户兴趣图谱
   ────────────
   数据结构：有向图 (NetworkX DiGraph)
   
   节点类型：
   ├─ \"query:\" 前缀 - 用户查询词
   ├─ \"clicked:\" 前缀 - 用户点击的推荐相关词
   └─ \"feedback:\" 前缀 - 用户评论中的词
   
   权重管理：
   ├─ 初始权重：query 0.5, clicked 0.8, feedback 0.6
   ├─ 更新公式：new_w = 0.7 × old_w + 0.3 × current_w
   └─ 衰减公式：decayed_w = w × (0.95 ^ (days / 7))
   
   边的含义：
   ├─ 源→目标 表示从某个查询或反馈到被点击推荐的转移
   ├─ 边权重表示这个关系的强度
   └─ 支持单向和双向关系
   
   自动修剪：
   ├─ 当节点数 > 1000 时触发
   ├─ 保留权重最高的700个节点
   ├─ 删除权重 < 0.01 的节点
   └─ 自动衰减超时节点


4️⃣  演化机制
   ────────
   触发条件（满足任一即可）：
   ├─ 条件1：最近5次交互的平均质量评分 < 0.6
   └─ 条件2：检测到显著改进趋势（最近vs之前，差异>0.15）
   
   演化流程：
   ├─ Step 1: 智能体B进行自我改进
   │  ├─ 分析最近的反馈历史
   │  ├─ 总结成功和失败模式
   │  └─ 生成新的改进规则
   │
   ├─ Step 2: 智能体A应用改进
   │  ├─ 接收B生成的改进指导
   │  ├─ 调整推荐排序策略
   │  ├─ 添加新的过滤条件
   │  └─ 更新推荐生成逻辑
   │
   └─ Step 3: 版本升级
      ├─ agent_a.version += 1
      ├─ agent_b.version += 1
      ├─ agent_b.evolution_stages += 1
      └─ 记录演化历史


5️⃣  互惠受益分数 (MBS)
   ────────────────
   计算公式：
   MBS(t) = 0.7 × MBS(t-1) + 0.3 × Q(t)
   
   含义：
   ├─ 追踪双智能体协作的整体效果
   ├─ 0.7的系数保留长期历史
   ├─ 0.3的系数响应最新质量
   ├─ 范围0-1，越接近1越好
   └─ 目标：MBS > 0.7 表示良好协作
\"\"\"

WORKFLOW_OVERVIEW = \"\"\"
【完整工作流程概览】

   ┌─────────────────────────────────────────────────┐
   │           用户查询: \"人工智能在医疗中的应用\"      │
   └──────────────────┬──────────────────────────────┘
                      ▼
   ┌──────────────────────────────────┐
   │  智能体A: 获取推荐兴趣上下文      │
   │  ├─ 主要兴趣: 医疗AI (0.85)     │
   │  ├─ 相关兴趣: 深度学习 (0.76)  │
   │  └─ 查询相关度: 0.9             │
   └──────────────────┬───────────────┘
                      ▼
   ┌──────────────────────────────────┐
   │  Qwen2.5 LLM: 生成推荐           │
   │  返回5个推荐及理由                │
   └──────────────────┬───────────────┘
                      ▼
   ┌───────────────────────────────────────┐
   │  推荐结果:                            │
   │  1. \"深度学习在医学影像的应用\"      │
   │  2. \"CNN用于肿瘤检测\"               │
   │  3. \"医疗数据隐私保护技术\"          │
   │  4. \"医学NLP自然语言处理\"           │
   │  5. \"智能诊断系统\"                  │
   └───────────────┬──────────────────────┘
                   ▼
   ┌────────────────────────────────────┐
   │  用户交互反馈:                      │
   │  ├─ 点击: [0, 2] (第1和3项)        │
   │  ├─ 浏览时间: 45.5s, 120.3s        │
   │  ├─ 转化: 否                       │
   │  ├─ 满意度: 0.7                   │
   │  └─ 评论: \"不错，但缺少案例\"      │
   └────────────────┬───────────────────┘
                    ▼
   ┌────────────────────────────────────┐
   │  智能体B: 评估推荐质量             │
   │  ├─ 点击率: 40%                   │
   │  ├─ 浏览时长: 82.9s (83%)         │
   │  ├─ 转化: 否 (0%)                 │
   │  ├─ 满意度: 0.7                   │
   │  └─ 质量评分: 0.65 (接受)         │
   └────────────────┬───────────────────┘
                    ▼
   ┌────────────────────────────────────┐
   │  问题识别:                          │
   │  ├─ 点击率达到目标 (0.4)           │
   │  ├─ 用户反馈: 缺少应用案例         │
   │  └─ 建议: 优化推荐描述             │
   └────────────────┬───────────────────┘
                    ▼
   ┌────────────────────────────────────┐
   │  兴趣图谱更新:                      │
   │  ├─ 添加词: \"医疗\", \"AI\", ...    │
   │  ├─ 创建关系:                      │
   │  │  医疗 → 医学影像                │
   │  │  医疗 → 医学影像 (权重0.8)      │
   │  └─ 图谱版本: 1 → 2               │
   └────────────────┬───────────────────┘
                    ▼
   ┌────────────────────────────────────┐
   │  演化判定:                          │
   │  ├─ 平均质量评分: 0.65 < 0.6?     │
   │  ├─ 改进趋势: 检测中...             │
   │  └─ 判定: 继续监测                 │
   └────────────────┬───────────────────┘
                    ▼
   ┌────────────────────────────────────┐
   │  系统状态更新:                      │
   │  ├─ 互惠受益分数: 0.65             │
   │  ├─ 交互次数: +1                   │
   │  ├─ 推荐历史记录                    │
   │  └─ 反馈历史记录                    │
   └────────────────────────────────────┘
\"\"\"

COMPARISON_WITH_SIMPLE_SYSTEM = \"\"\"
【与传统推荐系统的对比】

┌─────────────────────┬──────────────────┬──────────────────────┐
│      特性          │   传统系统        │  本系统（双智能体）   │
├─────────────────────┼──────────────────┼──────────────────────┤
│ 推荐生成            │ 协同过滤/内容    │ LLM + 兴趣图谱       │
│ 反馈处理            │ 简单统计          │ 多维度评估           │
│ 自我改进            │ 无（需人工调参）  │ 自动自我学习         │
│ 兴趣模型            │ 静态向量          │ 动态演化的知识图     │
│ 系统演化            │ 版本发布          │ 连续自动演化         │
│ 新兴趣拓展          │ 困难（冷启动）    │ 自然融合             │
│ 用户适应时间        │ 数天到数周        │ 实时适应             │
│ 可解释性            │ 中等              │ 高（图谱可视化）     │
│ 计算复杂度          │ 低                │ 中（有LLM推理）      │
│ 长期精准度          │ 一般              │ 优秀（持续演化）     │
└─────────────────────┴──────────────────┴──────────────────────┘
\"\"\"

PERFORMANCE_METRICS = \"\"\"
【性能指标监测】

关键指标 (KPI):
───────────
1. 质量评分 (Quality Score)
   ├─ 定义：0-1的综合分数
   ├─ 计算：Q = Cr×0.4 + Br×0.3 + Cv×0.2 + Sa×0.1
   ├─ 目标：> 0.7
   └─ 用途：判断整体推荐效果

2. 点击率 (Click Through Rate)
   ├─ 定义：点击推荐 / 总推荐数
   ├─ 目标：> 0.4 (40%)
   └─ 用途：测量相关性

3. 浏览时长 (Browse Time)
   ├─ 定义：用户在推荐上的总时间
   ├─ 目标：> 60秒
   └─ 用途：测量吸引力

4. 转化率 (Conversion Rate)
   ├─ 定义：完成指定动作 / 推荐数
   ├─ 目标：> 0.2 (20%)
   └─ 用途：测量最终效果

5. 用户满意度 (Satisfaction Score)
   ├─ 定义：用户主观评分 0-1
   ├─ 目标：> 0.7
   └─ 用途：测量用户体验

6. 互惠受益分数 (Mutual Benefit Score)
   ├─ 定义：双智能体协作效果
   ├─ 计算：MBS = 0.7×MBS_prev + 0.3×Q
   ├─ 目标：> 0.7
   └─ 用途：整体系统健康度


演化指标：
─────────
1. 演化次数
   - 追踪系统进行了多少次版本升级
   - 反映系统的学习频率

2. 平均质量趋势
   - 展示系统整体质量的变化方向
   - 正向趋势表示演化有效

3. 规则学习数
   - 智能体B学到的改进规则总数
   - 反映系统的知识积累

4. 图谱增长速度
   - 兴趣图谱节点数的增长率
   - 反映用户兴趣的丰富度
\"\"\"

USE_CASES = \"\"\"
【应用场景】

场景1：学术研究论文推荐系统
─────────────────────────
用户：博士研究生
初始查询：\"深度学习在医学影像中的应用\"

第1-3天：
- 系统推荐相关论文和教程
- 用户点击率30%，满意度0.6
- 系统识别\"相关性不足\"问题

第4-7天：
- 智能体B生成改进规则
- 系统推荐更针对性的内容
- 点击率提升到45%，满意度0.75
- 触发演化（第1阶段）

第8-14天：
- 系统自动调整排序策略
- 用户兴趣图谱扩展到50个主题
- 推荐从\"医学影像\"拓展到\"医疗AI\"生态
- 继续演化，系统逐步完美适应用户


场景2：电商产品推荐
──────────────────
用户：家居装修爱好者
初始查询：\"北欧风格客厅\"

第1周：
- 推荐北欧家具和装饰品
- 用户浏览多件商品但转化率低
- 智能体B识别\"缺少整体搭配方案\"

第2周：
- 系统改为推荐完整搭配方案
- 转化率从5%提升到18%
- 演化触发，智能体A调整推荐方式

第3-4周：
- 兴趣图谱学到用户喜欢\"简约\"和\"功能性\"
- 自动推荐相关风格的新产品
- 用户满意度持续上升，系统逐步成为\"个人顾问\"


场景3：内容平台推荐
──────────────────
用户：技术博主
初始查询：\"Python Web开发\"

交互过程：
- Day 1-3：基础Web框架教程（CTR 35%）
- Day 4-7：实战项目案例（CTR 50%）
- Day 8-15：高级技术深度文章（CTR 55%）
- Day 16-30：完全个性化混合推荐（CTR 65%，转化20%）

演化过程：
- 阶段1：学习用户技术等级
- 阶段2：学习推荐内容类型偏好
- 阶段3：形成完整用户模型
- 阶段4+：持续微调和优化


场景4：招聘平台职位推荐
──────────────────────
用户：求职者
初始查询：\"Python开发工程师\"

系统演化：
- Week 1：推荐「Python开发工程师」职位
- Week 2：系统识别用户也感兴趣「AI」→ 扩展推荐
- Week 3：发现用户偏好「远程工作」→ 调整过滤
- Week 4：学习用户「薪资期望」范围 → 精准推荐
- Month 2：系统成为\"职业顾问\"，推荐职业发展路径
\"\"\"

TECHNICAL_HIGHLIGHTS = \"\"\"
【技术亮点】

1. 🧠 LLM集成
   ──────────
   ✓ 集成Qwen2.5-0.5B-Instruct模型
   ✓ 支持动态提示词构造
   ✓ 生成自然语言推荐理由
   ✓ 可扩展到更大模型（1.5B、7B等）

2. 📊 图论算法
   ────────────
   ✓ 使用NetworkX进行图操作
   ✓ 有向图表示复杂关系
   ✓ 权重管理和衰减
   ✓ 自动图修剪和优化

3. 🔄 演化算法
   ───────────
   ✓ 双向反馈循环
   ✓ 自适应阈值判断
   ✓ 规则学习和应用
   ✓ 版本控制和历史追踪

4. 💾 持久化存储
   ──────────────
   ✓ JSON格式保存用户会话
   ✓ 兴趣图谱完整序列化
   ✓ 演化历史记录
   ✓ 支持会话恢复

5. ⚡ 设备优化
   ─────────────
   ✓ GPU > MPS > CPU自动选择
   ✓ 浮点精度自适应
   ✓ 内存效率优化
   ✓ 支持多设备配置

6. 🧪 测试覆盖
   ────────────
   ✓ 单元测试（兴趣图谱、智能体）
   ✓ 集成测试（完整工作流）
   ✓ 演化测试（版本升级）
   ✓ 会话测试（持久化）
\"\"\"

NEXT_STEPS = \"\"\"
【后续优化方向】

短期（1-2周）：
──────────────
□ 优化Qwen2.5提示词工程，提升推荐质量
□ 添加更多反馈维度（分享数、收藏数等）
□ 实现推荐A/B测试框架
□ 完善错误处理和日志系统

中期（1个月）：
───────────────
□ 多用户并发支持和隔离
□ 推荐多样性约束（防止过拟合）
□ 冷启动问题解决方案
□ 推荐理由的可解释性增强

长期（2-3个月）：
─────────────────
□ 支持更大的LLM模型
□ 跨用户协同学习
□ 实时反馈数据流处理
□ Web服务和API接口
□ 可视化仪表板
□ 生产环境部署和监测

研究方向：
──────────
□ 元学习（快速适应新用户）
□ 因果推断（理解用户偏好的根本原因）
□ 多目标优化（平衡推荐质量vs多样性）
□ 联邦学习（隐私保护的分布式学习）
\"\"\"

if __name__ == \"__main__\":
    print(SYSTEM_OVERVIEW)
    print(\"\\n\" + \"=\"*80)\n    print(KEY_FEATURES)
    print(\"\\n\" + \"=\"*80)\n    print(WORKFLOW_OVERVIEW)
    print(\"\\n\" + \"=\"*80)\n    print(COMPARISON_WITH_SIMPLE_SYSTEM)
    print(\"\\n\" + \"=\"*80)\n    print(PERFORMANCE_METRICS)
    print(\"\\n\" + \"=\"*80)\n    print(USE_CASES)
    print(\"\\n\" + \"=\"*80)\n    print(TECHNICAL_HIGHLIGHTS)
    print(\"\\n\" + \"=\"*80)\n    print(NEXT_STEPS)
"